score_round1<-read_csv(paste0(output_location,"Round ","1","/results by team.csv"))
score_round2<-read_csv(paste0(output_location,"Round ","2","/results by team.csv"))
scores_cumulative<-score_by_team%>%
bind_rows(score_round1)%>%
bind_rows(score_round2)%>%
group_by(team_name)%>%
summarise(cumulative_score=sum(score,na.rm=T))%>%
arrange(desc(cumulative_score))
}
score_by_location<-read_csv(paste0(output_location,"Round ",round_no,"/results by location.csv"))
seqnum_list <- unique(score_by_location$seqnum)
for (i in 1:length(seqnum_list)){
filtered_data <- score_by_location %>% filter(seqnum == seqnum_list[i])
# Create a leaflet map
map <- leaflet() %>%
addProviderTiles(providers$CartoDB.Positron)
# Add lines connecting each guess to its corresponding actual coordinate
for (i in 1:nrow(filtered_data)) {
map <- map %>%
addPolylines(
lng = c(filtered_data$longitude[i], filtered_data$longitude_guess[i]),
lat = c(filtered_data$latitude[i], filtered_data$latitude_guess[i]),
color = "black", opacity = 1, weight=1
)
}
# Add points for actual coordinates
map <- map %>%
addCircleMarkers(
data = filtered_data,
lng = ~longitude, lat = ~latitude,
color = "yellow", stroke = TRUE, weight = 4,
fillColor = "black", fillOpacity = 1, radius = 5,
popup = ~paste("Actual location ", max(filtered_data$seqnum))
)
# Add points for guessed coordinates
map <- map %>%
addCircleMarkers(
data = filtered_data,
lng = ~longitude_guess, lat = ~latitude_guess,
color = "black", stroke = TRUE, weight = 2,
fillColor = "red", fillOpacity = 1, radius = 5,
popup = ~paste(team_name,
"<br>","Distance: ",distance_label,
"<br>","Score: ",score)
)
if (city=="DC"){
map<-map%>%
setView(lng = -77.0369, lat = 38.9072, zoom = 11)
}
if (city=="NYC"){
map<-map%>%
setView(lng = -73.9663, lat = 40.7076, zoom = 10)
}
# Render the map
print(max(filtered_data$seqnum))
print(map)
}
library(tibble)
library(dplyr)
library(readr)
library(sf)
library(httr)
library(jsonlite)
library(purrr)
library(tidyverse)
library(janitor)
library(googlesheets4)
library(stringr)
library(geosphere)
library(leaflet)
library(magick)
library(metro)
library(gtfstools)
city <- "NYC"        #DC or NYC
round_no <- 1
google_sheet_link<-"https://docs.google.com/spreadsheets/d/188wl-XhzJ0fz0TCU9zHMOKmARJes0_Is-VX1b9NZgAs/edit?usp=sharing"
pano<-"off" #on or off to save panorama pictures of locations
auto_run<-"yes"
at_large_percent<-1
downtown_percent<-0
greater_central_percent<-0
metro_percent<-0
metro_distance<-100 #distance from metro stations, in feet
manhattan_percent<-.43
brooklyn_percent<-.32
queens_percent<-.12
bronx_percent<-.03
subway_percent<-.10
subway_distance<-100 #distance from subway stations, in feet
code_base<-paste0("C:/Users/jwest/github/geoguessr_cities/")
output_location<-paste0("C:/Users/jwest/github/geoguessr_cities/",city,"/output/")
if (auto_run=="yes"){
source(paste0(code_base,"01_borders.R"))
source(paste0(code_base,"02_locations.R"))
source(paste0(code_base,"03_metadata.R"))
source(paste0(code_base,"04_images.R"))
}
View(locations)
if (city=="DC"){
max_dist<-73000
}
if (city=="NYC"){
max_dist<-130000
}
answers<-read_csv(paste0(output_location,"Round ",round_no,"/locations.csv"))
guesses <- read_sheet(google_sheet_link)%>%
filter(round==round_no)%>%
group_by(team_name,location)%>%
filter(datetime==max(datetime))%>%
ungroup()
score_by_location<-answers%>%
right_join(guesses,by=c("seqnum"="location"))%>%
mutate(distance = distHaversine(cbind(longitude, latitude), cbind(longitude_guess, latitude_guess)) * 3.28084)%>%
mutate(score=round(5000 * exp(-10 * distance / max_dist),0))%>%
mutate(distance_label=ifelse(
distance<5280,paste0(round(distance,0)," ft"),
paste0(round(distance/5280,1)," mi")))
score_by_team<-score_by_location%>%
group_by(team_name)%>%
summarise(score=sum(score,na.rm=T))
write_csv(score_by_location, paste0(output_location,"Round ",round_no,"/results by location.csv"))
write_csv(score_by_team, paste0(output_location,"Round ",round_no,"/results by team.csv"))
if (round_no==1){
scores_cumulative<-score_by_team%>%
group_by(team_name)%>%
summarise(cumulative_score=sum(score,na.rm=T))%>%
arrange(desc(cumulative_score))
}
if (round_no==2){
score_round1<-read_csv(paste0(output_location,"Round ","1","/results by team.csv"))
scores_cumulative<-score_by_team%>%
bind_rows(score_round1)%>%
group_by(team_name)%>%
summarise(cumulative_score=sum(score,na.rm=T))%>%
arrange(desc(cumulative_score))
}
if (round_no==3){
score_round1<-read_csv(paste0(output_location,"Round ","1","/results by team.csv"))
score_round2<-read_csv(paste0(output_location,"Round ","2","/results by team.csv"))
scores_cumulative<-score_by_team%>%
bind_rows(score_round1)%>%
bind_rows(score_round2)%>%
group_by(team_name)%>%
summarise(cumulative_score=sum(score,na.rm=T))%>%
arrange(desc(cumulative_score))
}
score_by_location<-read_csv(paste0(output_location,"Round ",round_no,"/results by location.csv"))
seqnum_list <- unique(score_by_location$seqnum)
for (i in 1:length(seqnum_list)){
filtered_data <- score_by_location %>% filter(seqnum == seqnum_list[i])
# Create a leaflet map
map <- leaflet() %>%
addProviderTiles(providers$CartoDB.Positron)
# Add lines connecting each guess to its corresponding actual coordinate
for (i in 1:nrow(filtered_data)) {
map <- map %>%
addPolylines(
lng = c(filtered_data$longitude[i], filtered_data$longitude_guess[i]),
lat = c(filtered_data$latitude[i], filtered_data$latitude_guess[i]),
color = "black", opacity = 1, weight=1
)
}
# Add points for actual coordinates
map <- map %>%
addCircleMarkers(
data = filtered_data,
lng = ~longitude, lat = ~latitude,
color = "yellow", stroke = TRUE, weight = 4,
fillColor = "black", fillOpacity = 1, radius = 5,
popup = ~paste("Actual location ", max(filtered_data$seqnum))
)
# Add points for guessed coordinates
map <- map %>%
addCircleMarkers(
data = filtered_data,
lng = ~longitude_guess, lat = ~latitude_guess,
color = "black", stroke = TRUE, weight = 2,
fillColor = "red", fillOpacity = 1, radius = 5,
popup = ~paste(team_name,
"<br>","Distance: ",distance_label,
"<br>","Score: ",score)
)
if (city=="DC"){
map<-map%>%
setView(lng = -77.0369, lat = 38.9072, zoom = 11)
}
if (city=="NYC"){
map<-map%>%
setView(lng = -73.9663, lat = 40.7076, zoom = 10)
}
# Render the map
print(max(filtered_data$seqnum))
print(map)
}
View(scores_cumulative)
library(tibble)
library(dplyr)
library(readr)
library(sf)
library(httr)
library(jsonlite)
library(purrr)
library(tidyverse)
library(janitor)
library(googlesheets4)
library(stringr)
library(geosphere)
library(leaflet)
library(magick)
library(metro)
library(gtfstools)
city <- "NYC"        #DC or NYC
round_no <- 2
google_sheet_link<-"https://docs.google.com/spreadsheets/d/188wl-XhzJ0fz0TCU9zHMOKmARJes0_Is-VX1b9NZgAs/edit?usp=sharing"
pano<-"off" #on or off to save panorama pictures of locations
auto_run<-"yes"
at_large_percent<-1
downtown_percent<-0
greater_central_percent<-0
metro_percent<-0
metro_distance<-100 #distance from metro stations, in feet
manhattan_percent<-.43
brooklyn_percent<-.32
queens_percent<-.12
bronx_percent<-.03
subway_percent<-.10
subway_distance<-100 #distance from subway stations, in feet
code_base<-paste0("C:/Users/jwest/github/geoguessr_cities/")
output_location<-paste0("C:/Users/jwest/github/geoguessr_cities/",city,"/output/")
if (auto_run=="yes"){
source(paste0(code_base,"01_borders.R"))
source(paste0(code_base,"02_locations.R"))
source(paste0(code_base,"03_metadata.R"))
source(paste0(code_base,"04_images.R"))
}
if (city=="DC"){
max_dist<-73000
}
if (city=="NYC"){
max_dist<-130000
}
answers<-read_csv(paste0(output_location,"Round ",round_no,"/locations.csv"))
guesses <- read_sheet(google_sheet_link)%>%
filter(round==round_no)%>%
group_by(team_name,location)%>%
filter(datetime==max(datetime))%>%
ungroup()
score_by_location<-answers%>%
right_join(guesses,by=c("seqnum"="location"))%>%
mutate(distance = distHaversine(cbind(longitude, latitude), cbind(longitude_guess, latitude_guess)) * 3.28084)%>%
mutate(score=round(5000 * exp(-10 * distance / max_dist),0))%>%
mutate(distance_label=ifelse(
distance<5280,paste0(round(distance,0)," ft"),
paste0(round(distance/5280,1)," mi")))
score_by_team<-score_by_location%>%
group_by(team_name)%>%
summarise(score=sum(score,na.rm=T))
write_csv(score_by_location, paste0(output_location,"Round ",round_no,"/results by location.csv"))
write_csv(score_by_team, paste0(output_location,"Round ",round_no,"/results by team.csv"))
if (round_no==1){
scores_cumulative<-score_by_team%>%
group_by(team_name)%>%
summarise(cumulative_score=sum(score,na.rm=T))%>%
arrange(desc(cumulative_score))
}
if (round_no==2){
score_round1<-read_csv(paste0(output_location,"Round ","1","/results by team.csv"))
scores_cumulative<-score_by_team%>%
bind_rows(score_round1)%>%
group_by(team_name)%>%
summarise(cumulative_score=sum(score,na.rm=T))%>%
arrange(desc(cumulative_score))
}
if (round_no==3){
score_round1<-read_csv(paste0(output_location,"Round ","1","/results by team.csv"))
score_round2<-read_csv(paste0(output_location,"Round ","2","/results by team.csv"))
scores_cumulative<-score_by_team%>%
bind_rows(score_round1)%>%
bind_rows(score_round2)%>%
group_by(team_name)%>%
summarise(cumulative_score=sum(score,na.rm=T))%>%
arrange(desc(cumulative_score))
}
score_by_location<-read_csv(paste0(output_location,"Round ",round_no,"/results by location.csv"))
seqnum_list <- unique(score_by_location$seqnum)
for (i in 1:length(seqnum_list)){
filtered_data <- score_by_location %>% filter(seqnum == seqnum_list[i])
# Create a leaflet map
map <- leaflet() %>%
addProviderTiles(providers$CartoDB.Positron)
# Add lines connecting each guess to its corresponding actual coordinate
for (i in 1:nrow(filtered_data)) {
map <- map %>%
addPolylines(
lng = c(filtered_data$longitude[i], filtered_data$longitude_guess[i]),
lat = c(filtered_data$latitude[i], filtered_data$latitude_guess[i]),
color = "black", opacity = 1, weight=1
)
}
# Add points for actual coordinates
map <- map %>%
addCircleMarkers(
data = filtered_data,
lng = ~longitude, lat = ~latitude,
color = "yellow", stroke = TRUE, weight = 4,
fillColor = "black", fillOpacity = 1, radius = 5,
popup = ~paste("Actual location ", max(filtered_data$seqnum))
)
# Add points for guessed coordinates
map <- map %>%
addCircleMarkers(
data = filtered_data,
lng = ~longitude_guess, lat = ~latitude_guess,
color = "black", stroke = TRUE, weight = 2,
fillColor = "red", fillOpacity = 1, radius = 5,
popup = ~paste(team_name,
"<br>","Distance: ",distance_label,
"<br>","Score: ",score)
)
if (city=="DC"){
map<-map%>%
setView(lng = -77.0369, lat = 38.9072, zoom = 11)
}
if (city=="NYC"){
map<-map%>%
setView(lng = -73.9663, lat = 40.7076, zoom = 10)
}
# Render the map
print(max(filtered_data$seqnum))
print(map)
}
View(scores_cumulative)
library(tibble)
library(dplyr)
library(readr)
library(sf)
library(httr)
library(jsonlite)
library(purrr)
library(tidyverse)
library(janitor)
library(googlesheets4)
library(stringr)
library(geosphere)
library(leaflet)
library(magick)
library(metro)
library(gtfstools)
city <- "NYC"        #DC or NYC
round_no <- 3
google_sheet_link<-"https://docs.google.com/spreadsheets/d/188wl-XhzJ0fz0TCU9zHMOKmARJes0_Is-VX1b9NZgAs/edit?usp=sharing"
pano<-"off" #on or off to save panorama pictures of locations
auto_run<-"yes"
at_large_percent<-1
downtown_percent<-0
greater_central_percent<-0
metro_percent<-0
metro_distance<-100 #distance from metro stations, in feet
manhattan_percent<-0
brooklyn_percent<-0
queens_percent<-0
bronx_percent<-0
subway_percent<-1
subway_distance<-300 #distance from subway stations, in feet
code_base<-paste0("C:/Users/jwest/github/geoguessr_cities/")
output_location<-paste0("C:/Users/jwest/github/geoguessr_cities/",city,"/output/")
if (auto_run=="yes"){
source(paste0(code_base,"01_borders.R"))
source(paste0(code_base,"02_locations.R"))
source(paste0(code_base,"03_metadata.R"))
source(paste0(code_base,"04_images.R"))
}
library(tibble)
library(dplyr)
library(readr)
library(sf)
library(httr)
library(jsonlite)
library(purrr)
library(tidyverse)
library(janitor)
library(googlesheets4)
library(stringr)
library(geosphere)
library(leaflet)
library(magick)
library(metro)
library(gtfstools)
city <- "NYC"        #DC or NYC
round_no <- 3
google_sheet_link<-"https://docs.google.com/spreadsheets/d/188wl-XhzJ0fz0TCU9zHMOKmARJes0_Is-VX1b9NZgAs/edit?usp=sharing"
pano<-"off" #on or off to save panorama pictures of locations
auto_run<-"yes"
at_large_percent<-1
downtown_percent<-0
greater_central_percent<-0
metro_percent<-0
metro_distance<-100 #distance from metro stations, in feet
manhattan_percent<-0
brooklyn_percent<-0
queens_percent<-0
bronx_percent<-0
subway_percent<-1
subway_distance<-300 #distance from subway stations, in feet
code_base<-paste0("C:/Users/jwest/github/geoguessr_cities/")
output_location<-paste0("C:/Users/jwest/github/geoguessr_cities/",city,"/output/")
if (auto_run=="yes"){
source(paste0(code_base,"01_borders.R"))
source(paste0(code_base,"02_locations.R"))
source(paste0(code_base,"03_metadata.R"))
source(paste0(code_base,"04_images.R"))
}
View(locations)
locations$location[1]
if (city=="DC"){
max_dist<-73000
}
if (city=="NYC"){
max_dist<-130000
}
answers<-read_csv(paste0(output_location,"Round ",round_no,"/locations.csv"))
guesses <- read_sheet(google_sheet_link)%>%
filter(round==round_no)%>%
group_by(team_name,location)%>%
filter(datetime==max(datetime))%>%
ungroup()
score_by_location<-answers%>%
right_join(guesses,by=c("seqnum"="location"))%>%
mutate(distance = distHaversine(cbind(longitude, latitude), cbind(longitude_guess, latitude_guess)) * 3.28084)%>%
mutate(score=round(5000 * exp(-10 * distance / max_dist),0))%>%
mutate(distance_label=ifelse(
distance<5280,paste0(round(distance,0)," ft"),
paste0(round(distance/5280,1)," mi")))
score_by_team<-score_by_location%>%
group_by(team_name)%>%
summarise(score=sum(score,na.rm=T))
write_csv(score_by_location, paste0(output_location,"Round ",round_no,"/results by location.csv"))
write_csv(score_by_team, paste0(output_location,"Round ",round_no,"/results by team.csv"))
if (round_no==1){
scores_cumulative<-score_by_team%>%
group_by(team_name)%>%
summarise(cumulative_score=sum(score,na.rm=T))%>%
arrange(desc(cumulative_score))
}
if (round_no==2){
score_round1<-read_csv(paste0(output_location,"Round ","1","/results by team.csv"))
scores_cumulative<-score_by_team%>%
bind_rows(score_round1)%>%
group_by(team_name)%>%
summarise(cumulative_score=sum(score,na.rm=T))%>%
arrange(desc(cumulative_score))
}
if (round_no==3){
score_round1<-read_csv(paste0(output_location,"Round ","1","/results by team.csv"))
score_round2<-read_csv(paste0(output_location,"Round ","2","/results by team.csv"))
scores_cumulative<-score_by_team%>%
bind_rows(score_round1)%>%
bind_rows(score_round2)%>%
group_by(team_name)%>%
summarise(cumulative_score=sum(score,na.rm=T))%>%
arrange(desc(cumulative_score))
}
score_by_location<-read_csv(paste0(output_location,"Round ",round_no,"/results by location.csv"))
seqnum_list <- unique(score_by_location$seqnum)
for (i in 1:length(seqnum_list)){
filtered_data <- score_by_location %>% filter(seqnum == seqnum_list[i])
# Create a leaflet map
map <- leaflet() %>%
addProviderTiles(providers$CartoDB.Positron)
# Add lines connecting each guess to its corresponding actual coordinate
for (i in 1:nrow(filtered_data)) {
map <- map %>%
addPolylines(
lng = c(filtered_data$longitude[i], filtered_data$longitude_guess[i]),
lat = c(filtered_data$latitude[i], filtered_data$latitude_guess[i]),
color = "black", opacity = 1, weight=1
)
}
# Add points for actual coordinates
map <- map %>%
addCircleMarkers(
data = filtered_data,
lng = ~longitude, lat = ~latitude,
color = "yellow", stroke = TRUE, weight = 4,
fillColor = "black", fillOpacity = 1, radius = 5,
popup = ~paste("Actual location ", max(filtered_data$seqnum))
)
# Add points for guessed coordinates
map <- map %>%
addCircleMarkers(
data = filtered_data,
lng = ~longitude_guess, lat = ~latitude_guess,
color = "black", stroke = TRUE, weight = 2,
fillColor = "red", fillOpacity = 1, radius = 5,
popup = ~paste(team_name,
"<br>","Distance: ",distance_label,
"<br>","Score: ",score)
)
if (city=="DC"){
map<-map%>%
setView(lng = -77.0369, lat = 38.9072, zoom = 11)
}
if (city=="NYC"){
map<-map%>%
setView(lng = -73.9663, lat = 40.7076, zoom = 10)
}
# Render the map
print(max(filtered_data$seqnum))
print(map)
}
View(scores_cumulative)
View(locations)
